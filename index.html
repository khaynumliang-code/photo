<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>互动星系画廊 - ttpp</title>
    <style>
        body {
            margin: 0;
            background: radial-gradient(circle at center, #001a33 0%, #000000 80%);
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1500px;
            /* --- 核心修复：禁止浏览器默认的滑动行为 --- */
            touch-action: none; 
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        #starfield {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            filter: blur(1px);
        }

        .stage {
            position: relative;
            width: 0; height: 0;
            transform-style: preserve-3d;
            transform: rotateX(-15deg);
            will-change: transform;
        }

        .carousel, .outer-carousel {
            position: absolute;
            transform-style: preserve-3d;
            left: 0; top: 0;
            will-change: transform;
        }

        .photo, .asteroid {
            position: absolute;
            object-fit: cover;
            border: 1px solid rgba(255,255,255,0.4);
            box-shadow: 0 0 15px rgba(0,242,255,0.3);
            transform-origin: center;
            -webkit-box-reflect: below 15px linear-gradient(transparent, rgba(0,0,0,0.1));
            /* 防止手指点到图片时触发系统的“保存图片”或“选择文字” */
            pointer-events: none; 
        }

        .photo { width: 180px; height: 250px; border-radius: 12px; margin-left: -90px; margin-top: -125px; }
        .asteroid { width: 70px; height: 70px; border-radius: 50%; margin-left: -35px; margin-top: -35px; }

        @media (max-width: 768px) {
            .photo, .asteroid { -webkit-box-reflect: none !important; filter: none !important; }
            .photo { width: 120px; height: 160px; margin-left: -60px; margin-top: -80px; }
        }
    </style>
</head>
<body>

    <div id="starfield"></div>

    <div class="stage" id="stage">
        <div class="carousel" id="carousel"></div>
        <div class="outer-carousel" id="outer-carousel"></div>
    </div>

    <script>
        const myImages = ['ttpp1.jpg', 'ttpp2.jpg', 'ttpp3.jpg'];
        const stage = document.getElementById('stage');
        const carousel = document.getElementById('carousel');
        const outerCarousel = document.getElementById('outer-carousel');
        const starfield = document.getElementById('starfield');
        const isMobile = window.innerWidth <= 768;

        // 初始化布局
        function init() {
            for (let i = 0; i < (isMobile ? 50 : 120); i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 2 + 'px';
                star.style.width = size; star.style.height = size;
                star.style.left = Math.random() * 100 + 'vw';
                star.style.top = Math.random() * 100 + 'vh';
                starfield.appendChild(star);
            }

            const totalMain = isMobile ? 6 : 10;
            const radiusMain = isMobile ? 260 : 450;
            for (let i = 0; i < totalMain; i++) {
                const img = document.createElement('img');
                img.className = 'photo';
                img.src = myImages[i % myImages.length];
                const angle = i * (360 / totalMain);
                img.style.transform = `rotateY(${angle}deg) translateZ(${radiusMain}px)`;
                carousel.appendChild(img);
            }

            const totalOuter = isMobile ? 8 : 15;
            const radiusOuter = isMobile ? 500 : 800;
            for (let i = 0; i < totalOuter; i++) {
                const img = document.createElement('img');
                img.className = 'asteroid';
                img.src = myImages[i % myImages.length];
                const angle = i * (360 / totalOuter);
                const randomY = (Math.random() - 0.5) * (isMobile ? 300 : 500);
                img.style.transform = `rotateY(${angle}deg) translateZ(${radiusOuter}px) translateY(${randomY}px)`;
                outerCarousel.appendChild(img);
            }
        }

        // 交互逻辑
        let isPointerDown = false;
        let startX, startY;
        let targetRotateY = 0;
        let targetRotateX = -15;
        let currentRotateY = 0;
        let currentRotateX = -15;

        // 统一处理鼠标和触摸
        const getPoint = (e) => {
            if (e.touches && e.touches.length > 0) {
                return { x: e.touches[0].clientX, y: e.touches[0].clientY };
            }
            return { x: e.clientX, y: e.clientY };
        };

        const onStart = (e) => {
            isPointerDown = true;
            const p = getPoint(e);
            startX = p.x;
            startY = p.y;
        };

        const onMove = (e) => {
            if (!isPointerDown) return;
            // 阻止移动端的默认拉动刷新/翻页行为
            if (e.cancelable) e.preventDefault(); 

            const p = getPoint(e);
            const deltaX = (p.x - startX) * 0.3; // 灵敏度
            const deltaY = (p.y - startY) * 0.3;

            targetRotateY += deltaX;
            targetRotateX -= deltaY;

            // 限制仰角，防止画面翻个底朝天
            targetRotateX = Math.max(-50, Math.min(50, targetRotateX));

            startX = p.x;
            startY = p.y;
        };

        const onEnd = () => { isPointerDown = false; };

        function update() {
            currentRotateY += (targetRotateY - currentRotateY) * 0.1;
            currentRotateX += (targetRotateX - currentRotateX) * 0.1;

            carousel.style.transform = `rotateY(${currentRotateY}deg)`;
            outerCarousel.style.transform = `rotateY(${-currentRotateY * 0.5}deg)`;
            stage.style.transform = `rotateX(${currentRotateX}deg)`;

            requestAnimationFrame(update);
        }

        // 事件绑定
        window.addEventListener('mousedown', onStart);
        window.addEventListener('touchstart', onStart, {passive: false});
        window.addEventListener('mousemove', onMove);
        window.addEventListener('touchmove', onMove, {passive: false});
        window.addEventListener('mouseup', onEnd);
        window.addEventListener('touchend', onEnd);

        init();
        update();
    </script>
</body>
</html>
