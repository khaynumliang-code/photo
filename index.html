<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>互动星系画廊 - ttpp</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: radial-gradient(circle at center, #001a33 0%, #000000 80%);
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            /* 使用 Flex 确保容器本身居中 */
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
            /* 关键：视点必须在正中心 */
            perspective-origin: center center; 
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        #starfield {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
        }

        /* 舞台居中逻辑：取消 fixed，使用相对中心 */
        .stage {
            position: relative;
            transform-style: preserve-3d;
            /* 初始倾斜 */
            transform: rotateX(-10deg);
            will-change: transform;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .carousel, .outer-carousel {
            position: absolute;
            transform-style: preserve-3d;
            will-change: transform;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .photo, .asteroid {
            position: absolute;
            object-fit: cover;
            border: 1px solid rgba(255,255,255,0.4);
            box-shadow: 0 0 15px rgba(0,242,255,0.3);
            /* 强制变换中心 */
            transform-origin: center center;
            pointer-events: none;
            -webkit-box-reflect: below 15px linear-gradient(transparent, rgba(0,0,0,0.1));
        }

        /* 电脑尺寸 */
        .photo { width: 180px; height: 250px; border-radius: 12px; }
        .asteroid { width: 60px; height: 60px; border-radius: 50%; }

        /* 手机适配：核心是缩小半径和取消昂贵特效 */
        @media (max-width: 768px) {
            .photo { 
                width: 100px; height: 140px; 
                -webkit-box-reflect: none !important;
                filter: none !important;
            }
            .asteroid { width: 40px; height: 40px; filter: none !important;}
        }
    </style>
</head>
<body>

    <div id="starfield"></div>

    <div class="stage" id="stage">
        <div class="carousel" id="carousel"></div>
        <div class="outer-carousel" id="outer-carousel"></div>
    </div>

    <script>
        const myImages = ['ttpp1.jpg', 'ttpp2.jpg', 'ttpp3.jpg'];
        const stage = document.getElementById('stage');
        const carousel = document.getElementById('carousel');
        const outerCarousel = document.getElementById('outer-carousel');
        const starfield = document.getElementById('starfield');
        const isMobile = window.innerWidth <= 768;

        function init() {
            // 星星
            for (let i = 0; i < (isMobile ? 40 : 100); i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 2 + 'px';
                star.style.width = size; star.style.height = size;
                star.style.left = Math.random() * 100 + 'vw';
                star.style.top = Math.random() * 100 + 'vh';
                starfield.appendChild(star);
            }

            // 内圈
            const totalMain = isMobile ? 6 : 10;
            const radiusMain = isMobile ? 160 : 400; // 手机端进一步缩小半径防止偏离
            for (let i = 0; i < totalMain; i++) {
                const img = document.createElement('img');
                img.className = 'photo';
                img.src = myImages[i % myImages.length];
                const angle = i * (360 / totalMain);
                // 确保 translateZ 是最后的变换
                img.style.transform = `rotateY(${angle}deg) translateZ(${radiusMain}px)`;
                carousel.appendChild(img);
            }

            // 外圈
            const totalOuter = isMobile ? 6 : 12;
            const radiusOuter = isMobile ? 280 : 700;
            for (let i = 0; i < totalOuter; i++) {
                const img = document.createElement('img');
                img.className = 'asteroid';
                img.src = myImages[i % myImages.length];
                const angle = i * (360 / totalOuter);
                const randomY = (Math.random() - 0.5) * (isMobile ? 150 : 400);
                img.style.transform = `rotateY(${angle}deg) translateZ(${radiusOuter}px) translateY(${randomY}px)`;
                outerCarousel.appendChild(img);
            }
        }

        let isPointerDown = false;
        let startX, startY;
        let targetRotateY = 0;
        let targetRotateX = -10;
        let currentRotateY = 0;
        let currentRotateX = -10;

        const getPoint = (e) => {
            if (e.touches && e.touches.length > 0) return { x: e.touches[0].clientX, y: e.touches[0].clientY };
            return { x: e.clientX, y: e.clientY };
        };

        window.addEventListener('mousedown', (e) => { isPointerDown = true; const p = getPoint(e); startX = p.x; startY = p.y; });
        window.addEventListener('touchstart', (e) => { isPointerDown = true; const p = getPoint(e); startX = p.x; startY = p.y; }, {passive: false});

        window.addEventListener('mousemove', (e) => {
            if (!isPointerDown) return;
            const p = getPoint(e);
            targetRotateY += (p.x - startX) * 0.3;
            targetRotateX -= (p.y - startY) * 0.3;
            targetRotateX = Math.max(-35, Math.min(35, targetRotateX));
            startX = p.x; startY = p.y;
        });

        window.addEventListener('touchmove', (e) => {
            if (!isPointerDown) return;
            if (e.cancelable) e.preventDefault();
            const p = getPoint(e);
            targetRotateY += (p.x - startX) * 0.5; // 手机端稍微灵敏点
            targetRotateX -= (p.y - startY) * 0.5;
            targetRotateX = Math.max(-35, Math.min(35, targetRotateX));
            startX = p.x; startY = p.y;
        }, {passive: false});

        window.addEventListener('mouseup', () => isPointerDown = false);
        window.addEventListener('touchend', () => isPointerDown = false);

        function update() {
            currentRotateY += (targetRotateY - currentRotateY) * 0.1;
            currentRotateX += (targetRotateX - currentRotateX) * 0.1;

            // 这里是关键：stage 不再使用 translate(-50%,-50%)，而是靠 flex 居中，只负责 rotateX
            stage.style.transform = `rotateX(${currentRotateX}deg)`;
            carousel.style.transform = `rotateY(${currentRotateY}deg)`;
            outerCarousel.style.transform = `rotateY(${-currentRotateY * 0.4}deg)`;

            requestAnimationFrame(update);
        }

        init();
        update();
    </script>
</body>
</html>
