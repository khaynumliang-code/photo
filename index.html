<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>互动星系画廊 - ttpp</title>
    <style>
        body {
            margin: 0;
            background: radial-gradient(circle at center, #001a33 0%, #000000 80%);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1200px;
            perspective-origin: 50% 50%; /* 强制透视点在正中心 */
            touch-action: none; 
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        #starfield {
            position: fixed;
            width: 100%; height: 100%;
            z-index: -1;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
        }

        /* 核心修复：使用 fixed 居中定位舞台 */
        .stage {
            position: fixed;
            top: 50%;
            left: 50%;
            transform-style: preserve-3d;
            transform: translate(-50%, -50%) rotateX(-10deg);
            will-change: transform;
        }

        .carousel, .outer-carousel {
            position: absolute;
            transform-style: preserve-3d;
            left: 0; top: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            will-change: transform;
        }

        .photo, .asteroid {
            position: absolute;
            object-fit: cover;
            border: 1px solid rgba(255,255,255,0.4);
            box-shadow: 0 0 15px rgba(0,242,255,0.3);
            transform-origin: center center;
            -webkit-box-reflect: below 15px linear-gradient(transparent, rgba(0,0,0,0.1));
            pointer-events: none; 
        }

        /* 电脑端尺寸 */
        .photo { width: 180px; height: 250px; border-radius: 12px; margin-left: -90px; margin-top: -125px; }
        .asteroid { width: 70px; height: 70px; border-radius: 50%; margin-left: -35px; margin-top: -35px; }

        /* 手机端专门适配 */
        @media (max-width: 768px) {
            .photo { 
                width: 110px; height: 150px; 
                margin-left: -55px; margin-top: -75px; 
                -webkit-box-reflect: none !important; 
                filter: none !important; 
            }
            .asteroid { 
                width: 40px; height: 40px; 
                margin-left: -20px; margin-top: -20px; 
                filter: none !important;
            }
        }
    </style>
</head>
<body>

    <div id="starfield"></div>

    <div class="stage" id="stage">
        <div class="carousel" id="carousel"></div>
        <div class="outer-carousel" id="outer-carousel"></div>
    </div>

    <script>
        const myImages = ['ttpp1.jpg', 'ttpp2.jpg', 'ttpp3.jpg'];
        const stage = document.getElementById('stage');
        const carousel = document.getElementById('carousel');
        const outerCarousel = document.getElementById('outer-carousel');
        const starfield = document.getElementById('starfield');
        const isMobile = window.innerWidth <= 768;

        function init() {
            // 生成星星
            for (let i = 0; i < (isMobile ? 40 : 120); i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = (Math.random() * 2) + 'px';
                star.style.width = size; star.style.height = size;
                star.style.left = Math.random() * 100 + 'vw';
                star.style.top = Math.random() * 100 + 'vh';
                starfield.appendChild(star);
            }

            // 内圈：手机端半径缩小至 170
            const totalMain = isMobile ? 8 : 10;
            const radiusMain = isMobile ? 170 : 450;
            for (let i = 0; i < totalMain; i++) {
                const img = document.createElement('img');
                img.className = 'photo';
                img.src = myImages[i % myImages.length];
                const angle = i * (360 / totalMain);
                img.style.transform = `rotateY(${angle}deg) translateZ(${radiusMain}px)`;
                carousel.appendChild(img);
            }

            // 外圈：手机端半径缩小至 300
            const totalOuter = isMobile ? 8 : 15;
            const radiusOuter = isMobile ? 300 : 800;
            for (let i = 0; i < totalOuter; i++) {
                const img = document.createElement('img');
                img.className = 'asteroid';
                img.src = myImages[i % myImages.length];
                const angle = i * (360 / totalOuter);
                const randomY = (Math.random() - 0.5) * (isMobile ? 200 : 500);
                img.style.transform = `rotateY(${angle}deg) translateZ(${radiusOuter}px) translateY(${randomY}px)`;
                outerCarousel.appendChild(img);
            }
        }

        // 交互逻辑
        let isPointerDown = false;
        let startX, startY;
        let targetRotateY = 0;
        let targetRotateX = -10;
        let currentRotateY = 0;
        let currentRotateX = -10;

        const getPoint = (e) => {
            if (e.touches && e.touches.length > 0) return { x: e.touches[0].clientX, y: e.touches[0].clientY };
            return { x: e.clientX, y: e.clientY };
        };

        const onStart = (e) => {
            isPointerDown = true;
            const p = getPoint(e);
            startX = p.x; startY = p.y;
        };

        const onMove = (e) => {
            if (!isPointerDown) return;
            if (e.cancelable) e.preventDefault(); 
            const p = getPoint(e);
            const deltaX = (p.x - startX) * 0.4;
            const deltaY = (p.y - startY) * 0.4;

            targetRotateY += deltaX;
            targetRotateX -= deltaY;
            targetRotateX = Math.max(-40, Math.min(40, targetRotateX));

            startX = p.x; startY = p.y;
        };

        const onEnd = () => { isPointerDown = false; };

        function update() {
            currentRotateY += (targetRotateY - currentRotateY) * 0.08;
            currentRotateX += (targetRotateX - currentRotateX) * 0.08;

            // 修正应用位置，确保 stage 在正中心
            carousel.style.transform = `rotateY(${currentRotateY}deg)`;
            outerCarousel.style.transform = `rotateY(${-currentRotateY * 0.3}deg)`;
            // 同时应用平移和旋转，确保居中
            stage.style.transform = `translate(-50%, -50%) rotateX(${currentRotateX}deg)`;

            requestAnimationFrame(update);
        }

        window.addEventListener('mousedown', onStart);
        window.addEventListener('touchstart', onStart, {passive: false});
        window.addEventListener('mousemove', onMove);
        window.addEventListener('touchmove', onMove, {passive: false});
        window.addEventListener('mouseup', onEnd);
        window.addEventListener('touchend', onEnd);

        init();
        update();
    </script>
</body>
</html>
