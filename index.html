<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>互动星系画廊 - ttpp</title>
    <style>
        body {
            margin: 0;
            background: radial-gradient(circle at center, #001a33 0%, #000000 80%);
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            /* 调整视距：手机端稍微远一点，防止物体“冲”出屏幕 */
            perspective: 1200px;
            /* 确保视点在屏幕中心 */
            perspective-origin: center center;
            touch-action: none; 
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        #starfield {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
        }

        .stage {
            position: relative;
            /* 显式定义舞台为中心点 */
            width: 0; height: 0;
            transform-style: preserve-3d;
            will-change: transform;
        }

        .carousel, .outer-carousel {
            position: absolute;
            transform-style: preserve-3d;
            /* 确保旋转中心对齐 */
            left: 50%; top: 50%;
            will-change: transform;
        }

        .photo, .asteroid {
            position: absolute;
            object-fit: cover;
            border: 1px solid rgba(255,255,255,0.4);
            box-shadow: 0 0 15px rgba(0,242,255,0.3);
            transform-origin: center center;
            -webkit-box-reflect: below 15px linear-gradient(transparent, rgba(0,0,0,0.1));
            pointer-events: none; 
        }

        /* 电脑端尺寸 */
        .photo { width: 180px; height: 250px; border-radius: 12px; margin-left: -90px; margin-top: -125px; }
        .asteroid { width: 70px; height: 70px; border-radius: 50%; margin-left: -35px; margin-top: -35px; }

        /* 手机端专门调整 */
        @media (max-width: 768px) {
            body { perspective: 1000px; }
            .photo { 
                width: 100px; height: 140px; 
                margin-left: -50px; margin-top: -70px; /* 严格居中对齐 */
                -webkit-box-reflect: none !important; 
                filter: none !important; 
            }
            .asteroid { 
                width: 50px; height: 50px; 
                margin-left: -25px; margin-top: -25px; /* 严格居中对齐 */
                filter: none !important;
            }
        }
    </style>
</head>
<body>

    <div id="starfield"></div>

    <div class="stage" id="stage">
        <div class="carousel" id="carousel"></div>
        <div class="outer-carousel" id="outer-carousel"></div>
    </div>

    <script>
        const myImages = ['ttpp1.jpg', 'ttpp2.jpg', 'ttpp3.jpg'];
        const stage = document.getElementById('stage');
        const carousel = document.getElementById('carousel');
        const outerCarousel = document.getElementById('outer-carousel');
        const starfield = document.getElementById('starfield');
        const isMobile = window.innerWidth <= 768;

        function init() {
            // 星星数量优化
            const starCount = isMobile ? 40 : 120;
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = (Math.random() * 2) + 'px';
                star.style.width = size; star.style.height = size;
                star.style.left = Math.random() * 100 + 'vw';
                star.style.top = Math.random() * 100 + 'vh';
                starfield.appendChild(star);
            }

            // 内圈：手机端半径缩小至 180-200 确保在屏幕内
            const totalMain = isMobile ? 6 : 10;
            const radiusMain = isMobile ? 180 : 450;
            for (let i = 0; i < totalMain; i++) {
                const img = document.createElement('img');
                img.className = 'photo';
                img.src = myImages[i % myImages.length];
                const angle = i * (360 / totalMain);
                img.style.transform = `rotateY(${angle}deg) translateZ(${radiusMain}px)`;
                carousel.appendChild(img);
            }

            // 外圈：手机端半径缩小
            const totalOuter = isMobile ? 8 : 15;
            const radiusOuter = isMobile ? 320 : 800;
            for (let i = 0; i < totalOuter; i++) {
                const img = document.createElement('img');
                img.className = 'asteroid';
                img.src = myImages[i % myImages.length];
                const angle = i * (360 / totalOuter);
                const randomY = (Math.random() - 0.5) * (isMobile ? 250 : 500);
                img.style.transform = `rotateY(${angle}deg) translateZ(${radiusOuter}px) translateY(${randomY}px)`;
                outerCarousel.appendChild(img);
            }
        }

        let isPointerDown = false;
        let startX, startY;
        let targetRotateY = 0;
        let targetRotateX = -10;
        let currentRotateY = 0;
        let currentRotateX = -10;

        const getPoint = (e) => {
            if (e.touches) return { x: e.touches[0].clientX, y: e.touches[0].clientY };
            return { x: e.clientX, y: e.clientY };
        };

        const onStart = (e) => {
            isPointerDown = true;
            const p = getPoint(e);
            startX = p.x; startY = p.y;
        };

        const onMove = (e) => {
            if (!isPointerDown) return;
            if (e.cancelable) e.preventDefault(); 
            const p = getPoint(e);
            const deltaX = (p.x - startX) * 0.3;
            const deltaY = (p.y - startY) * 0.3;

            targetRotateY += deltaX;
            targetRotateX -= deltaY;
            targetRotateX = Math.max(-40, Math.min(40, targetRotateX));

            startX = p.x; startY = p.y;
        };

        const onEnd = () => { isPointerDown = false; };

        function update() {
            // 平滑缓动
            currentRotateY += (targetRotateY - currentRotateY) * 0.08;
            currentRotateX += (targetRotateX - currentRotateX) * 0.08;

            // 应用旋转
            carousel.style.transform = `translate(-50%, -50%) rotateY(${currentRotateY}deg)`;
            outerCarousel.style.transform = `translate(-50%, -50%) rotateY(${-currentRotateY * 0.3}deg)`;
            stage.style.transform = `rotateX(${currentRotateX}deg)`;

            requestAnimationFrame(update);
        }

        window.addEventListener('mousedown', onStart);
        window.addEventListener('touchstart', onStart, {passive: false});
        window.addEventListener('mousemove', onMove);
        window.addEventListener('touchmove', onMove, {passive: false});
        window.addEventListener('mouseup', onEnd);
        window.addEventListener('touchend', onEnd);

        init();
        update();
    </script>
</body>
</html>
